<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas Town Control Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'gt-dark': '#1a1a2e',
                        'gt-card': '#16213e',
                        'gt-input': '#0f172a',
                        'gt-border': '#333333',
                    }
                }
            }
        }
    </script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, monospace;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 20px;
        }
        h1 { font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        h1::before { content: 'üè≠'; }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
        }
        .status-green { background: #4ade80; box-shadow: 0 0 10px #4ade80; }
        .status-yellow { background: #fbbf24; box-shadow: 0 0 10px #fbbf24; }
        .status-red { background: #f87171; box-shadow: 0 0 10px #f87171; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .card {
            background: #16213e;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
        }
        .card h2 {
            font-size: 1rem;
            color: #94a3b8;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .card-content { font-size: 0.9rem; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #333; }
        th { color: #64748b; font-weight: 500; }
        .chat-container {
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            height: 400px;
        }
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #0f172a;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .message {
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 8px;
            max-width: 80%;
        }
        .message.sent {
            background: #3b82f6;
            margin-left: auto;
        }
        .message.received {
            background: #334155;
        }
        .chat-input {
            display: flex;
            gap: 10px;
        }
        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #0f172a;
            color: #fff;
            font-size: 0.9rem;
        }
        .chat-input button {
            padding: 12px 24px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        .chat-input button:hover { background: #2563eb; }
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .badge-green { background: #166534; color: #4ade80; }
        .badge-yellow { background: #854d0e; color: #fbbf24; }
        .badge-red { background: #991b1b; color: #f87171; }
        .badge-blue { background: #1e40af; color: #60a5fa; }
        #status-time { color: #64748b; font-size: 0.8rem; }
        .terminal-container {
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .terminal-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .terminal-controls select {
            flex: 1;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #333;
            background: #0f172a;
            color: #e2e8f0;
        }
        .terminal-controls button {
            padding: 10px 18px;
            border-radius: 8px;
            border: none;
            background: #22c55e;
            color: #0b1220;
            font-weight: 600;
            cursor: pointer;
        }
        .terminal-controls button.disconnect {
            background: #f97316;
            color: #0b1220;
        }
        .terminal-output {
            background: #0b1120;
            color: #e2e8f0;
            border-radius: 10px;
            padding: 16px;
            min-height: 220px;
            max-height: 420px;
            overflow-y: auto;
            font-family: "Menlo", "Monaco", "Courier New", monospace;
            font-size: 0.85rem;
            line-height: 1.4;
            border: 1px solid #1f2a44;
            white-space: pre-wrap;
        }
        /* Mobile responsive styles */
        @media (max-width: 768px) {
            .container { padding: 12px; }
            header { padding: 12px 0; margin-bottom: 12px; }
            h1 { font-size: 1.2rem; }
            .grid { grid-template-columns: 1fr; gap: 12px; }
            .card { padding: 15px; }
            .card h2 { font-size: 0.9rem; margin-bottom: 10px; }
            .terminal-output {
                min-height: 150px;
                max-height: 300px;
                padding: 12px;
                font-size: 0.75rem;
            }
            .chat-container { height: 300px; }
            .chat-input input { padding: 10px 12px; }
            .chat-input button { padding: 10px 16px; }
            table { font-size: 0.8rem; }
            th, td { padding: 6px 8px; }
            /* Mayor panel mobile grid */
            .mayor-grid {
                grid-template-columns: 1fr !important;
            }
        }
        @media (max-width: 480px) {
            .container { padding: 8px; }
            h1 { font-size: 1rem; }
            .card { padding: 12px; border-radius: 8px; }
            .terminal-output { font-size: 0.7rem; padding: 10px; }
            .chat-messages { padding: 10px; }
        }
        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1a1a2e; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Gas Town <span class="status-indicator status-green" id="daemon-status"></span></h1>
            <span id="status-time">Loading...</span>
        </header>

        <!-- Mayor Control Panel - Primary Interface -->
        <div class="card" style="margin-bottom: 20px; border: 2px solid #3b82f6;">
            <h2>üèõÔ∏è Mayor Control <span class="status-indicator" id="mayor-status"></span> <span id="mayor-hook" style="font-size: 0.75rem; color: #64748b; margin-left: 10px;"></span></h2>
            <div class="mayor-grid" style="display: grid; grid-template-columns: 1fr 350px; gap: 20px;">
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span style="color: #64748b; font-size: 0.8rem;">Mayor Terminal (hq-mayor)</span>
                        <button id="mayor-terminal-toggle" onclick="toggleMayorTerminal()" style="padding: 6px 12px; background: #22c55e; color: #0b1220; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">Connect</button>
                    </div>
                    <pre class="terminal-output" id="mayor-terminal" style="min-height: 300px; max-height: 400px;">Click "Connect" to view Mayor's terminal output.</pre>
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <div style="color: #64748b; font-size: 0.8rem;">Send Mail to Mayor</div>
                    <input type="text" id="mayor-mail-subject" placeholder="Subject" style="padding: 10px; border-radius: 6px; border: 1px solid #333; background: #0f172a; color: #fff;" />
                    <textarea id="mayor-mail-body" placeholder="Message to Mayor..." rows="6" style="padding: 10px; border-radius: 6px; border: 1px solid #333; background: #0f172a; color: #fff; resize: vertical; flex: 1;"></textarea>
                    <button onclick="sendMailToMayor()" style="padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">üì® Send to Mayor</button>
                    <div id="mayor-mail-result" style="font-size: 0.8rem; color: #64748b;"></div>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>üìä Rigs</h2>
                <div class="card-content" id="rigs-list">Loading...</div>
            </div>

            <div class="card">
                <h2>üöö Convoys</h2>
                <div class="card-content" id="convoys-list">Loading...</div>
            </div>

            <div class="card">
                <h2>üê± Polecats</h2>
                <div class="card-content" id="polecats-list">Loading...</div>
            </div>

            <div class="card" style="grid-column: 1 / -1;">
                <h2>üì¨ Mail Center</h2>
                <div class="card-content">
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 15px;">
                        <div style="flex: 1; min-width: 200px;">
                            <label style="color: #64748b; font-size: 0.8rem;">View Inbox For:</label>
                            <select id="mail-agent-select" onchange="loadAgentMail()" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #333; background: #0f172a; color: #fff; margin-top: 5px;">
                                <option value="mayor/">Mayor</option>
                            </select>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <label style="color: #64748b; font-size: 0.8rem;">Send To:</label>
                            <select id="mail-to-select" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #333; background: #0f172a; color: #fff; margin-top: 5px;">
                                <option value="mayor/">Mayor</option>
                            </select>
                        </div>
                    </div>
                    <div id="mail-inbox" style="background: #0f172a; border-radius: 8px; padding: 15px; max-height: 200px; overflow-y: auto; margin-bottom: 15px;">
                        <p style="color: #64748b;">Select an agent to view their inbox</p>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <input type="text" id="mail-subject" placeholder="Subject" style="padding: 10px; border-radius: 6px; border: 1px solid #333; background: #0f172a; color: #fff;" />
                        <textarea id="mail-body" placeholder="Message body..." rows="3" style="padding: 10px; border-radius: 6px; border: 1px solid #333; background: #0f172a; color: #fff; resize: vertical;"></textarea>
                        <button onclick="sendMailToAgent()" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">Send Mail</button>
                    </div>
                </div>
            </div>

            <div class="card chat-container">
                <h2>üí¨ Quick Message to Mayor</h2>
                <div class="chat-messages" id="chat-messages"></div>
                <div class="chat-input">
                    <input type="text" id="chat-input" placeholder="Send a message to Mayor..." />
                    <button onclick="sendMessage()">Send</button>
                </div>
            </div>

            <div class="card terminal-container">
                <h2>üñ•Ô∏è Polecat Terminal</h2>
                <div class="terminal-controls">
                    <select id="terminal-session"></select>
                    <button id="terminal-toggle" onclick="toggleTerminalStream()">Connect</button>
                </div>
                <pre class="terminal-output" id="terminal-output">Select a polecat session to view its terminal output.</pre>
            </div>
        </div>
    </div>

    <script>
        let terminalSource = null;
        let terminalConnected = false;
        function connectStatusSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
            const socket = new WebSocket(protocol + window.location.host + '/ws/status');

            socket.addEventListener('message', (event) => {
                try {
                    const data = JSON.parse(event.data);
                    updateUI(data);
                } catch (e) {
                    console.error('Failed to parse status update:', e);
                }
            });

            socket.addEventListener('close', () => {
                document.getElementById('status-time').textContent = 'Disconnected';
                setTimeout(connectStatusSocket, 2000);
            });

            socket.addEventListener('error', () => {
                socket.close();
            });
        }

        function updateUI(data) {
            // Update timestamp
            document.getElementById('status-time').textContent =
                'Updated: ' + new Date(data.timestamp).toLocaleTimeString();

            // Update daemon status
            const daemonIndicator = document.getElementById('daemon-status');
            daemonIndicator.className = 'status-indicator ' +
                (data.daemon.running ? 'status-green' : 'status-red');

            // Update rigs
            const rigsHtml = data.rigs && data.rigs.length > 0
                ? '<table><tr><th>Name</th><th>Polecats</th><th>Crew</th></tr>' +
                  data.rigs.map(r => '<tr><td>' + r.name + '</td><td>' + (r.polecats||0) + '</td><td>' + (r.crew||0) + '</td></tr>').join('') +
                  '</table>'
                : '<p>No rigs configured</p>';
            document.getElementById('rigs-list').innerHTML = rigsHtml;

            // Update convoys
            const convoysHtml = data.convoys && data.convoys.length > 0
                ? '<table><tr><th>ID</th><th>Title</th><th>Progress</th></tr>' +
                  data.convoys.map(c => '<tr><td>' + c.ID + '</td><td>' + c.Title + '</td><td>' + c.Progress + '</td></tr>').join('') +
                  '</table>'
                : '<p>No active convoys</p>';
            document.getElementById('convoys-list').innerHTML = convoysHtml;

            // Update polecats
            const polecatsHtml = data.polecats && data.polecats.length > 0
                ? '<table><tr><th>Name</th><th>Rig</th><th>Activity</th></tr>' +
                  data.polecats.map(p => '<tr><td>' + p.Name + '</td><td>' + p.Rig + '</td><td><span class="badge badge-' + getColorClass(p.LastActivity.ColorClass) + '">' + p.LastActivity.FormattedAge + '</span></td></tr>').join('') +
                  '</table>'
                : '<p>No polecats running</p>';
            document.getElementById('polecats-list').innerHTML = polecatsHtml;
            updateTerminalSessions(data.polecats || []);

            // Update mail
            document.getElementById('mail-status').innerHTML =
                '<p>Unread: <strong>' + data.mail.unread + '</strong> / Total: ' + data.mail.total + '</p>';
        }

        function getColorClass(color) {
            if (color === 'green' || color === 'activity-green') return 'green';
            if (color === 'yellow' || color === 'activity-yellow') return 'yellow';
            if (color === 'red' || color === 'activity-red') return 'red';
            return 'blue';
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            // Add sent message to chat
            addMessage(message, 'sent');
            input.value = '';

            try {
                const res = await fetch('/api/mail/send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        to: 'mayor/',
                        subject: 'Web GUI Message',
                        body: message
                    })
                });
                const data = await res.json();
                if (data.success) {
                    addMessage('Message sent to Mayor', 'received');
                } else {
                    addMessage('Error: ' + data.error, 'received');
                }
            } catch (e) {
                addMessage('Failed to send: ' + e.message, 'received');
            }
        }

        function addMessage(text, type) {
            const messages = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = 'message ' + type;
            div.textContent = text;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        function updateTerminalSessions(polecats) {
            const select = document.getElementById('terminal-session');
            if (!select) return;

            const previous = select.value;
            const sessions = polecats
                .filter(p => p.SessionID)
                .map(p => ({
                    id: p.SessionID,
                    label: p.Rig + '/' + p.Name
                }));

            select.innerHTML = '';
            if (sessions.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No active polecat sessions';
                select.appendChild(option);
                return;
            }

            sessions.forEach(session => {
                const option = document.createElement('option');
                option.value = session.id;
                option.textContent = session.label + ' (' + session.id + ')';
                select.appendChild(option);
            });

            if (previous && sessions.some(s => s.id === previous)) {
                select.value = previous;
                return;
            }
            select.selectedIndex = 0;
        }

        function toggleTerminalStream() {
            if (terminalConnected) {
                disconnectTerminalStream();
            } else {
                connectTerminalStream();
            }
        }

        function connectTerminalStream() {
            const select = document.getElementById('terminal-session');
            const output = document.getElementById('terminal-output');
            const toggle = document.getElementById('terminal-toggle');
            const session = select.value;
            if (!session) {
                output.textContent = 'No session selected.';
                return;
            }

            if (terminalSource) {
                terminalSource.close();
            }

            output.textContent = 'Connecting to ' + session + '...';
            terminalSource = new EventSource('/api/terminal/stream?session=' + encodeURIComponent(session));
            terminalConnected = true;
            toggle.textContent = 'Disconnect';
            toggle.classList.add('disconnect');

            terminalSource.addEventListener('frame', (event) => {
                output.textContent = event.data;
                output.scrollTop = output.scrollHeight;
            });

            terminalSource.addEventListener('error', (event) => {
                if (event.data) {
                    output.textContent = 'Error: ' + event.data;
                } else {
                    output.textContent = 'Stream disconnected.';
                }
                disconnectTerminalStream();
            });
        }

        function disconnectTerminalStream() {
            const toggle = document.getElementById('terminal-toggle');
            if (terminalSource) {
                terminalSource.close();
                terminalSource = null;
            }
            terminalConnected = false;
            toggle.textContent = 'Connect';
            toggle.classList.remove('disconnect');
        }

        // Handle Enter key in chat input
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // Mail Center functions
        async function loadAgentsList() {
            try {
                const res = await fetch('/api/agents/list');
                const agents = await res.json();
                const viewSelect = document.getElementById('mail-agent-select');
                const sendSelect = document.getElementById('mail-to-select');

                viewSelect.innerHTML = '';
                sendSelect.innerHTML = '';

                agents.forEach(agent => {
                    const opt1 = document.createElement('option');
                    opt1.value = agent.address;
                    opt1.textContent = agent.name + ' (' + agent.type + ')';
                    viewSelect.appendChild(opt1);

                    const opt2 = document.createElement('option');
                    opt2.value = agent.address;
                    opt2.textContent = agent.name + ' (' + agent.type + ')';
                    sendSelect.appendChild(opt2);
                });

                // Load mayor's mail by default
                loadAgentMail();
            } catch (e) {
                console.error('Failed to load agents:', e);
            }
        }

        async function loadAgentMail() {
            const agent = document.getElementById('mail-agent-select').value;
            const inbox = document.getElementById('mail-inbox');
            inbox.innerHTML = '<p style="color: #64748b;">Loading...</p>';

            try {
                const res = await fetch('/api/mail/all?agent=' + encodeURIComponent(agent));
                const data = await res.json();

                if (data.raw) {
                    inbox.innerHTML = '<pre style="white-space: pre-wrap; color: #e2e8f0; margin: 0;">' + escapeHtml(data.raw) + '</pre>';
                } else if (data.messages && Array.isArray(data.messages)) {
                    if (data.messages.length === 0) {
                        inbox.innerHTML = '<p style="color: #64748b;">No messages</p>';
                    } else {
                        inbox.innerHTML = data.messages.map(m =>
                            '<div style="border-bottom: 1px solid #333; padding: 8px 0;">' +
                            '<div style="font-weight: 500; color: #60a5fa;">' + escapeHtml(m.subject || 'No subject') + '</div>' +
                            '<div style="font-size: 0.8rem; color: #94a3b8;">From: ' + escapeHtml(m.from || 'unknown') + '</div>' +
                            '<div style="margin-top: 5px; color: #e2e8f0;">' + escapeHtml(m.body || m.content || '') + '</div>' +
                            '</div>'
                        ).join('');
                    }
                } else {
                    inbox.innerHTML = '<p style="color: #64748b;">No messages for ' + agent + '</p>';
                }
            } catch (e) {
                inbox.innerHTML = '<p style="color: #f87171;">Error: ' + e.message + '</p>';
            }
        }

        async function sendMailToAgent() {
            const to = document.getElementById('mail-to-select').value;
            const subject = document.getElementById('mail-subject').value.trim();
            const body = document.getElementById('mail-body').value.trim();

            if (!subject) {
                alert('Please enter a subject');
                return;
            }

            try {
                const res = await fetch('/api/mail/send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ to, subject, body })
                });
                const data = await res.json();

                if (data.success) {
                    alert('Mail sent to ' + to);
                    document.getElementById('mail-subject').value = '';
                    document.getElementById('mail-body').value = '';
                    loadAgentMail();
                } else {
                    alert('Failed: ' + (data.error || 'Unknown error'));
                }
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ========== Mayor Terminal Functions ==========
        let mayorTerminalSource = null;
        let mayorTerminalConnected = false;

        function toggleMayorTerminal() {
            if (mayorTerminalConnected) {
                disconnectMayorTerminal();
            } else {
                connectMayorTerminal();
            }
        }

        function connectMayorTerminal() {
            const output = document.getElementById('mayor-terminal');
            const toggle = document.getElementById('mayor-terminal-toggle');

            if (mayorTerminalSource) {
                mayorTerminalSource.close();
            }

            output.textContent = 'Connecting to hq-mayor...';
            mayorTerminalSource = new EventSource('/api/mayor/terminal');
            mayorTerminalConnected = true;
            toggle.textContent = 'Disconnect';
            toggle.style.background = '#f97316';

            mayorTerminalSource.addEventListener('frame', (event) => {
                output.textContent = event.data;
                output.scrollTop = output.scrollHeight;
            });

            mayorTerminalSource.addEventListener('error', (event) => {
                if (event.data) {
                    output.textContent = 'Error: ' + event.data;
                } else {
                    output.textContent = 'Mayor terminal disconnected. Click Connect to retry.';
                }
                disconnectMayorTerminal();
            });
        }

        function disconnectMayorTerminal() {
            const toggle = document.getElementById('mayor-terminal-toggle');
            if (mayorTerminalSource) {
                mayorTerminalSource.close();
                mayorTerminalSource = null;
            }
            mayorTerminalConnected = false;
            toggle.textContent = 'Connect';
            toggle.style.background = '#22c55e';
        }

        async function sendMailToMayor() {
            const subject = document.getElementById('mayor-mail-subject').value.trim();
            const body = document.getElementById('mayor-mail-body').value.trim();
            const result = document.getElementById('mayor-mail-result');

            if (!subject) {
                result.innerHTML = '<span style="color: #f87171;">Please enter a subject</span>';
                return;
            }

            result.innerHTML = '<span style="color: #fbbf24;">Sending...</span>';

            try {
                const res = await fetch('/api/mail/send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ to: 'mayor/', subject, body })
                });
                const data = await res.json();

                if (data.success) {
                    result.innerHTML = '<span style="color: #4ade80;">‚úì Mail sent to Mayor</span>';
                    document.getElementById('mayor-mail-subject').value = '';
                    document.getElementById('mayor-mail-body').value = '';
                    setTimeout(() => { result.innerHTML = ''; }, 3000);
                } else {
                    result.innerHTML = '<span style="color: #f87171;">Failed: ' + (data.error || 'Unknown error') + '</span>';
                }
            } catch (e) {
                result.innerHTML = '<span style="color: #f87171;">Error: ' + e.message + '</span>';
            }
        }

        async function updateMayorStatus() {
            try {
                const res = await fetch('/api/mayor/status');
                const data = await res.json();
                const indicator = document.getElementById('mayor-status');
                const hookSpan = document.getElementById('mayor-hook');

                if (data.session_exists) {
                    indicator.className = 'status-indicator status-green';
                } else {
                    indicator.className = 'status-indicator status-red';
                }

                if (data.hook && !data.hook.includes('Nothing on hook')) {
                    hookSpan.textContent = 'ü™ù Work hooked';
                    hookSpan.style.color = '#4ade80';
                } else {
                    hookSpan.textContent = 'No hook';
                    hookSpan.style.color = '#64748b';
                }
            } catch (e) {
                console.error('Failed to get mayor status:', e);
            }
        }

        // Update mayor status every 5 seconds
        setInterval(updateMayorStatus, 5000);

        // Initialize
        updateMayorStatus();
        loadAgentsList();

        // Start WebSocket updates
        connectStatusSocket();
    </script>
</body>
</html>
